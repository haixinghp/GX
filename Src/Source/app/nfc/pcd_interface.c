/*
 * pcd_interface.c
 *
 *  Created on: 2018年8月28日
 *      Author: CCORE YY
 */
#include "emv_layer4.h"
#include "pcd_interface.h"
#include "fm175xx.h"

/////////////////////////////////////////////////////////////////////
//读寄存器位
//input:Address=寄存器地址
//ouput:读出的值
/////////////////////////////////////////////////////////////////////
unsigned char ReadRawRC(unsigned char Address)
{
	return Read_Reg(Address);
}
/////////////////////////////////////////////////////////////////////
//                写寄存器
//input:Address=寄存器地址
//      value=要写入的值
/////////////////////////////////////////////////////////////////////
void WriteRawRC(unsigned char Address, unsigned char value)
{
	Write_Reg(Address,value);
}
/////////////////////////////////////////////////////////////////////
//input:reg=寄存器地址
//      mask=置位值
/////////////////////////////////////////////////////////////////////
void SetBitMask( unsigned char reg, unsigned char mask )
{
	Set_BitMask(reg,mask);
}

/////////////////////////////////////////////////////////////////////
//input:reg=寄存器地址
//      mask=清位值
/////////////////////////////////////////////////////////////////////
void ClearBitMask( unsigned char reg, unsigned char mask )
{
	Clear_BitMask(reg,mask);
}

/////////////////////////////////////////////////////////////////////
//设置PCD定时器
//input:fwi=0~15
/////////////////////////////////////////////////////////////////////
void PcdSetTmo(u8 fwi)
{
	Pcd_SetTimer(fwi);
}
/////////////////////////////////////////////////////////////////////
//开启天线硬复位
/////////////////////////////////////////////////////////////////////
void PcdHWReset(void)
{
	FM175XX_HardReset();
}
/////////////////////////////////////////////////////////////////////
//天线软件复位
/////////////////////////////////////////////////////////////////////
void PcdSoftReset(void)
{
	FM175XX_SoftReset();
}
/////////////////////////////////////////////////////////////////////
//开启天线
//每次启动或关闭天险发射之间应至少有1ms的间隔
/////////////////////////////////////////////////////////////////////
void PcdAntennaOn(void)
{
	Fm175xxAntennaOn();
}
/////////////////////////////////////////////////////////////////////
//关闭天线
/////////////////////////////////////////////////////////////////////
void PcdAntennaOff(void)
{
	Fm175xxAntennaOff();
}
//////////////////////////////////////////////////////////////////////
//设置工作方式
//////////////////////////////////////////////////////////////////////
char PcdConfigISOType(unsigned char type)
{
	if ('A' == type)
	{
		Pcd_ConfigISOType(0);
		return MI_OK;
	}
	else if ('B' == type)
	{
		Pcd_ConfigISOType(1);
		return MI_OK;
	}

	return (char)MI_CHK_FAILED;
}

char PcdComTransceive(struct TranSciveBuffer *pi)
{
	unsigned char cmd = 0;

	if(PCD_AUTHENT == pi->MfCommand)
		cmd = MFAuthent;
	else if(PCD_TRANSCEIVE == pi->MfCommand)
		cmd = Transceive;
	else
		return (char)(-1);

	if(OK == Pcd_Comm(cmd,
				pi->MfData,
				pi->MfLength,
				pi->MfData,
				&pi->MfLength))
	{
		return 0;
	}
	else
	{
		pi->MfLength = 0;
		return (char)(-1);
	}
}
