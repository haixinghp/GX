#include "Iomacros.h"
#include "memmap.h"
#include "dac_drv.h"
#include "dmac_drv.h"
#include "cpm_drv.h"
#include "xip_drv.h"
#include "dac_audio.h"
#include "eflash_drv.h"
#include "debug.h"
#include "delay.h"
#include "pit32_drv.h"
#include "eport_drv.h"
#include "adpcm.h"
#include "spi_reg.h"
#include "spi_drv.h"
unsigned char *sound_buf;
unsigned int sound_len;
unsigned int sound_s;
unsigned char sound_en=0;
unsigned char vol=1;
UINT32 AUDIO_ADDR;
UINT32 AUDIO_LEN;


extern UINT32 g_sys_clk;

#define  AUDIO_FRAME_SIZE  (5*1024) //???spi flash???????
extern int tmp_buf[79 * 1024 / 4];
//UINT32 tmp_buf[AUDIO_FRAME_SIZE];    //__attribute__((at(0x2000D560))); //?????buf1,???????0x10 ????
UINT16 Buffer2[AUDIO_FRAME_SIZE*2];//    __attribute__((at(0x20012560))); //?????buf2,???????0x10 ????
UINT8 break_song_compete;//??????????
UINT8 exit_to_break=0;//????????
UINT16 key_value=0xff;

UINT8 EncodeBuffer[AUDIO_FRAME_SIZE];
 struct adpcm_state dec_state={0x8000,0};
unsigned int AudioMem[AUDIO_MAX][2]=
{

      0x00000E34,        0x00004000,           
      0x00000C0F,        0x00004E34,         
      0x00000CD3,        0x00005A43,             
      0x00000DE5,        0x00006716,            
      0x00000EA9,        0x000074FB,             
      0x00000E82,        0x000083A4,             
      0x00000D70,        0x00009226,             
      0x00000C85,        0x00009F96,               
      0x00000C0F,        0x0000AC1B,             
      0x00001058,        0x0000B82A,            
      0x00000C5D,        0x0000C882,             
      0x00000CD3,        0x0000D4DF,            
      0x00000E34,        0x0000E1B2,             
      0x00000AAE,        0x0000EFE6,            
      0x00000B4B,        0x0000FA94,            
      0x00000CFA,        0x000105DF,             
      0x00000C36,        0x000112D9,             
      0x00001031,        0x00011F0F,             
      0x00000F46,        0x00012F40,             
      0x00001058,        0x00013E86,             
      0x00001031,        0x00014EDE,            
      0x00000EF8,        0x00015F0F,             
      0x00001058,        0x00016E07,             
      0x00000DBE,        0x00017E5F,            
      0x00000E82,        0x00018C1D,            
      0x0000111C,        0x00019A9F,             
      0x000010A7,        0x0001ABBB,             
      0x000010CE,        0x0001BC62,            
      0x00001080,        0x0001CD30,             
      0x00000F6D,        0x0001DDB0,             
      0x00000F94,        0x0001ED1D,            
      0x00000F46,        0x0001FCB1,            
      0x00001368,        0x00020BF7,            
      0x00001031,        0x00021F5F,             
      0x000010F5,        0x00022F90,             
      0x00001207,        0x00024085,             
      0x0000068C,        0x0002528C,             
      0x00002C0E,        0x00025918,             
      0x00003057,        0x00028526,             
      0x00008612,        0x0002B57D,            
      0x0000995C,        0x00033B8F,             
      0x00004577,        0x0003D4EB,             
      0x00002108,        0x00041A62,            
      0x000021A5,        0x00043B6A,             
      0x000020BA,        0x00045D0F,             
      0x000020BA,        0x00047DC9,             
      0x00002157,        0x00049E83,            
      0x00001D0D,        0x0004BFDA,            
      0x00001E95,        0x0004DCE7,            
      0x000021F3,        0x0004FB7C,            
      0x00002108,        0x00051D6F,             
      0x00001F32,        0x00053E77,             
      0x00001EE4,        0x00055DA9,             
      0x00002BBF,        0x00057C8D,             
      0x000028FE,        0x0005A84C,            
      0x00004578,        0x0005D14A,            
      0x00003BFA,        0x000616C2,             
      0x00002157,        0x000652BC,            
      0x00003367,        0x00067413,             
      0x00002B71,        0x0006A77A,            
      0x00002BBF,        0x0006D2EB,            
      0x0000364F,        0x0006FEAA,             
      0x00001E95,        0x000734F9,             
      0x00001DAA,        0x0007538E,             
      0x00002F1D,        0x00077138,             
      0x00001D0D,        0x0007A055,            
      0x00001C22,        0x0007BD62,            
      0x000022B7,        0x0007D984,             
      0x00002664,        0x0007FC3B,             
      0x00005873,        0x0008229F,             
      0x00005675,        0x00087B12,            
      0x00003191,        0x0008D187,             
      0x000023F1,        0x00090318,             
      0x000020BA,        0x00092709,             
      0x00002418,        0x000947C3,             
      0x00002092,        0x00096BDB,             
      0x00001FCE,        0x00098C6D,            
      0x00002D20,        0x0009AC3B,            
      0x00003762,        0x0009D95B,            
      0x0000395F,        0x000A10BD,            
      0x00003D5A,        0x000A4A1C,            
      0x00003318,        0x000A8776,             
      0x000031B8,        0x000ABA8E,             
      0x0000373A,        0x000AEC46,             
      0x00002551,        0x000B2380,             
      0x000028FE,        0x000B48D1,             
      0x0000406A,        0x000B71CF,             
      0x00003CBD,        0x000BB239,             
      0x00003C48,        0x000BEEF6,            
      0x0000237B,        0x000C2B3E,             
      0x000023C9,        0x000C4EB9,             
      0x000022DE,        0x000C7282,            
      0x00002108,        0x000C9560,             
      0x0000232D,        0x000CB668,             
      0x00001EBC,        0x000CD995,             
      0x00001CBF,        0x000CF851,             
      0x000025A0,        0x000D1510,             
      0x00006C32,        0x000D3AB0,            
      0x00004C33,        0x000DA6E2,             
      0x000030F4,        0x000DF315,             
      0x0000617B,        0x000E2409,             
      0x00001256,        0x000E8584,             
      0x0000100A,        0x000E97DA,             
      0x00000EF8,        0x000EA7E4,             
      0x0000749E,        0x000EB6DC,             
      0x000016EE,        0x000F2B7A,             
      0x000068FB,        0x000F4268,             
      0x000018C4,        0x000FAB63,             
      0x00001875,        0x000FC427,             
      0x00001875,        0x000FDC9C,             
      0x000019AF,        0x000FF511,             
      0x00001EE3,        0x00100EC0,            
      0x000021F3,        0x00102DA3,             
      0x000023C9,        0x00104F96,             
      0x00001BAC,        0x0010735F,             
      0x00001C97,        0x00108F0B,             
      0x00001C49,        0x0010ABA2,             
      0x00001BFB,        0x0010C7EB,             
      0x00001E1F,        0x0010E3E6,            
      0x00001D83,        0x00110205,             
      0x000020E1,        0x00111F88,             
      0x00001DF8,        0x00114069,             
      0x00001E47,        0x00115E61,             
      0x000021A5,        0x00117CA8,            
      0x000022B7,        0x00119E4D,             
      0x00001F0B,        0x0011C104,             
      0x000022DE,        0x0011E00F,          
      0x00002AD4,        0x001202ED,             
      0x00002C83,        0x00122DC1,             
      0x0000173C,        0x00125A44,            
      0x000013DE,        0x00127180,            
      0x00001F59,        0x0012855E,             
      0x00001D0D,        0x0012A4B7,             
      0x000023A2,        0x0012C1C4,            
      0x00001EE3,        0x0012E566,             
      0x00001F32,        0x00130449,             
      0x000030F4,        0x0013237B,            
      0x00001D5B,        0x0013546F,             
      0x00001C49,        0x001371CA,            
      0x00002A10,        0x00138E13,             
      0x00001D5B,        0x0013B823,             
      0x000021CC,        0x0013D57E,             
      0x00002044,        0x0013F74A,             
      0x00002F6C,        0x0014178E,             
      0x00003169,        0x001446FA,             
      0x00001DF8,        0x00147863,             
      0x00001F80,        0x0014965B,             
      0x00001F80,        0x0014B5DB,             
      0x000030A5,        0x0014D55B,            
      0x000033B5,        0x00150600,             
      0x00001E6E,        0x001539B5,             
      0x00001566,        0x00155823,             
      0x00001D5B,        0x00156D89,            
      0x00002305,        0x00158AE4,             
      0x000020BA,        0x0015ADE9,            
      0x00001DAA,        0x0015CEA3,            
      0x00001F0B,        0x0015EC4D,             
      0x00001DAA,        0x00160B58,             
      0x00001FA7,        0x00162902,             
      0x00001C97,        0x001648A9,             
      0x00001BFB,        0x00166540,             
      0x00002C5C,        0x0016813B,            
      0x000030A5,        0x0016AD97,             
      0x00002418,        0x0016DE3C,             
      0x00002925,        0x00170254,             
      0x000028FE,        0x00172B79,            
      0x000026D9,        0x00175477,             
      0x00002728,        0x00177B50,             
      0x00003452,        0x0017A278,             
      0x000024B5,        0x0017D6CA,             
      0x00002418,        0x0017FB7F,             
      0x00003628,        0x00181F97,             
      0x00003789,        0x001855BF,            
      0x000037FE,        0x00188D48,             
      0x0000395F,        0x0018C546,             
      0x00003938,        0x0018FEA5,            
      0x00003874,        0x001937DD,             

};
__align(4) UINT8 data_buf1[]={
0x00,0x40,0x32, 0x82, 0x05, 0xa6, 0x7f, 0xcf, 0x4c, 0xa5, 0x66, 0x46, 0x8e, 0x28, 0xbc, 0x7c, 0x9f, 0xde,
0xf1, 0xcc, 0x23, 0x54, 0x85, 0x01, 0xb1, 0x3a, 0x3c, 0xc0, 0xcd, 0xf3, 0x24, 0xa0, 0x34, 0x35,
0xe5, 0x2c, 0xd0, 0x83, 0x83, 0xd6, 0x31, 0xc9, 0x32, 0x5e, 0x94, 0x07, 0xcb, 0x33, 0x25, 0xb7,
0x32, 0xf4, 0xc3, 0xa7, 0xfe, 0x37, 0xd9, 0x27, 0x13, 0x81, 0x90, 0xd9, 0xd9, 0xc9, 0xef, 0x5b,
0xcb, 0x09, 0x61, 0x37, 0x6d, 0xb4, 0x12, 0xf0, 0x34, 0xaa, 0xad, 0x3c, 0xf7, 0x26, 0x45, 0x7c,
0x2d, 0xd8, 0x1a, 0xce, 0xb7, 0x5f, 0x5b, 0x07, 0x95, 0x32, 0x31, 0xb4, 0xd5, 0xf2, 0x11, 0xab,
0xcf, 0x3c, 0xc5, 0x27, 0xb4, 0x7a, 0xdf, 0xd4, 0xe5, 0xce, 0xe3, 0x64, 0xa3, 0x09, 0x41, 0x2e,
0xd8, 0xae, 0x5f, 0xf3, 0xf0, 0xaf, 0xc8, 0x3e, 0x1d, 0x25, 0x5a, 0x78, 0x2f, 0xd5, 0xd0, 0xcf,
0xfe, 0x65, 0x57, 0x0b, 0x21, 0x2e, 0xe6, 0xab, 0xa4, 0xf1, 0x5d, 0xb2, 0x18, 0x42, 0x90, 0x24,
0xa0, 0x74, 0x84, 0xd3, 0xb4, 0xd2, 0x6d, 0x69, 0xb7, 0x0a, 0xcf, 0x2a, 0x37, 0xaa, 0x97, 0xf2,
0x35, 0xb4, 0x87, 0x43, 0x82, 0x24, 0x68, 0x72, 0x2f, 0xd1, 0xbb, 0xd3, 0x7d, 0x6d, 0xa6, 0x0c,
0x7a, 0x27, 0xb5, 0xa5, 0xc6, 0xf2, 0x1e, 0xb8, 0x90, 0x45, 0xe7, 0x22, 0x0e, 0x70, 0x60, 0xd0,
0xb6, 0xd4, 0xb1, 0x6f, 0x3f, 0x0e, 0x52, 0x26, 0xa9, 0xa2, 0x8e, 0xf1, 0x86, 0xba, 0x9e, 0x48,
0x7f, 0x22, 0xaf, 0x6c, 0xa7, 0xce, 0xed, 0xd6, 0xdd, 0x72, 0x88, 0x0e, 0xb7, 0x23, 0x40, 0xa0,
0xac, 0xf1, 0xbb, 0xbc, 0x92, 0x4a, 0x46, 0x22, 0x59, 0x6a, 0x87, 0xcc, 0xe2, 0xd7, 0x8f, 0x76,
0x72, 0x10, 0xe4, 0x20, 0x28, 0x9c, 0x88, 0xf1, 0x0a, 0xc0, 0xcb, 0x4c, 0x54, 0x21, 0xeb, 0x67,
0x24, 0xcb, 0xdc, 0xd8, 0x2d, 0x79, 0x0e, 0x12, 0x72, 0x1f, 0x01, 0x99, 0x5d, 0xf0, 0x70, 0xc2,
0xc4, 0x4f, 0x02, 0x21, 0xd3, 0x64, 0x52, 0xc9, 0x8a, 0xda, 0x43, 0x7c, 0x03, 0x13, 0x43, 0x1d,
0x28, 0x96, 0x02, 0xf0, 0xbe, 0xc4, 0x05, 0x52, 0xdd, 0x20, 0x74, 0x62, 0x2e, 0xc7, 0x5f, 0xdb,
0xb9, 0x7f, 0xef, 0x14, 0xd7, 0x1a, 0x58, 0x92, 0x7a, 0xef, 0x9c, 0xc7, 0x76, 0x54, 0x5f, 0x20,
0xf9, 0x5f, 0x75, 0xc5, 0x42, 0xdc, 0x85, 0x82, 0xb5, 0x16, 0x63, 0x19, 0x13, 0x8f, 0x43, 0xee,
0xf8, 0xc9, 0x62, 0x57, 0x3a, 0x20, 0x25, 0x5d, 0x7e, 0xc3, 0x79, 0xdd, 0x8e, 0x85, 0x24, 0x18,
0x79, 0x17, 0xf6, 0x8b, 0x84, 0xed, 0x39, 0xcc, 0xde, 0x59, 0x42, 0x20, 0xc4, 0x5a, 0x4a, 0xc1,
0x34, 0xde, 0xd9, 0x88, 0x26, 0x1a, 0x7b, 0x15, 0x51, 0x88, 0x9f, 0xec, 0xc5, 0xce, 0x83, 0x5c,
0x15, 0x20, 0x4e, 0x58, 0x54, 0xbf, 0xe7, 0xde, 0xb3, 0x8b, 0x18, 0x1c, 0x13, 0x14, 0xf4, 0x84,
0x48, 0xeb, 0x04, 0xd1, 0x6d, 0x5f, 0x2c, 0x20, 0xb4, 0x55, 0x32, 0xbd, 0xc1, 0xdf, 0xb4, 0x8e,
0xe4, 0x1d, 0x73, 0x12, 0xb4, 0x81, 0x32, 0xea, 0x26, 0xd3, 0x19, 0x62, 0x65, 0x20, 0x57, 0x53,
0xeb, 0xba, 0x4b, 0xe0, 0xd0, 0x91, 0x05, 0x20, 0xd3, 0x10, 0x2c, 0x7e, 0xf6, 0xe8, 0x72, 0xd5,
0xe3, 0x64, 0x86, 0x20, 0xf7, 0x50, 0xc4, 0xb8, 0xcb, 0xe0, 0xb1, 0x94, 0x2a, 0x22, 0x90, 0x0f,
0xc6, 0x7a, 0x7a, 0xe7, 0x84, 0xd7, 0xce, 0x67, 0xd8, 0x20, 0x88, 0x4e, 0x7e, 0xb6, 0x56, 0xe1,
0x9f, 0x97, 0x3c, 0x24, 0x39, 0x0e, 0x72, 0x77, 0x0e, 0xe6, 0x7e, 0xd9, 0xa0, 0x6a, 0x45, 0x21,
0x3f, 0x4c, 0x21, 0xb4, 0xad, 0xe1, 0x97, 0x9a, 0x85, 0x26, 0xf1, 0x0c, 0xfa, 0x73, 0x8a, 0xe4,
0x8b, 0xdb, 0x82, 0x6d, 0xae, 0x21, 0xfc, 0x49, 0xcd, 0xb1, 0xf3, 0xe1, 0x6a, 0x9d, 0xd4, 0x28,
0xdb, 0x0b, 0x93, 0x70, 0xd9, 0xe2, 0x6c, 0xdd, 0x79, 0x70, 0x3d, 0x22, 0xb4, 0x47, 0x69, 0xaf,
0x35, 0xe2, 0x42, 0xa0, 0x27, 0x2b, 0xce, 0x0a, 0x3c, 0x6d, 0x25, 0xe1, 0x39, 0xdf, 0x69, 0x73,
0xe1, 0x22, 0x88, 0x45, 0xf3, 0xac, 0x53, 0xe2, 0x17, 0xa3, 0x94, 0x2d, 0xd2, 0x09, 0xd4, 0x69,
0x5a, 0xdf, 0x02, 0xe1, 0x5a, 0x76, 0x8b, 0x23, 0x61, 0x43, 0x81, 0xaa, 0x5d, 0xe2, 0xd7, 0xa5,
0x11, 0x30, 0xfe, 0x08, 0x78, 0x66, 0x72, 0xdd, 0xb1, 0xe2, 0x5d, 0x79, 0x58, 0x24, 0x47, 0x41,
0x03, 0xa8, 0x5d, 0xe2, 0x8d, 0xa8, 0x91, 0x32, 0x38, 0x08, 0x27, 0x63, 0x7c, 0xdb, 0x46, 0xe4,
0x59, 0x7c, 0x37, 0x25, 0x3d, 0x3f, 0x77, 0xa5, 0x40, 0xe2, 0x40, 0xab, 0x28, 0x35, 0x8a, 0x07,
0xd3, 0x5f, 0x75, 0xd9, 0xd3, 0xe5, 0x5c, 0x7f, 0x24, 0x26, 0x3e, 0x3d, 0xed, 0xa2, 0x0f, 0xe2,
0xe1, 0xad, 0xc9, 0x37, 0xf8, 0x06, 0x86, 0x5c, 0x4d, 0xd7, 0x42, 0xe7, 0x63, 0x82, 0x2a, 0x27,
0x4b, 0x3b, 0x56, 0xa0, 0xcc, 0xe1, 0x77, 0xb0, 0x72, 0x3a, 0x7c, 0x06, 0x44, 0x59, 0x20, 0xd5,
0xa0, 0xe8, 0x6b, 0x85, 0x47, 0x28, 0x6a, 0x39, 0xb9, 0x9d, 0x76, 0xe1, 0x02, 0xb3, 0x2b, 0x3d,
0x16, 0x06, 0x03, 0x56, 0xda, 0xd2, 0xe9, 0xe9, 0x73, 0x88, 0x70, 0x29, 0x95, 0x37, 0x1a, 0x9b,
0x09, 0xe1, 0x80, 0xb5, 0xf0, 0x3f, 0xc9, 0x05, 0xcd, 0x52, 0x80, 0xd0, 0x1c, 0xeb, 0x7f, 0x8b,
0xb2, 0x2a, 0xd2, 0x35, 0x77, 0x98, 0x89, 0xe0, 0xf0, 0xb7, 0xbd, 0x42, 0x99, 0x05, 0xa2, 0x4f,
0x17, 0xce, 0x34, 0xec, 0x89, 0x8e, 0x03, 0x2c, 0x1d, 0x34, 0xc7, 0x95, 0xf5, 0xdf, 0x51, 0xba,
0x94, 0x45, 0x7e, 0x05, 0x80, 0x4c, 0x9a, 0xcb, 0x3d, 0xed, 0x92, 0x91, 0x6d, 0x2d, 0x78, 0x32,
0x18, 0x93, 0x4c, 0xdf, 0xa6, 0xbc, 0x73, 0x48, 0x7a, 0x05, 0x65, 0x49, 0x0c, 0xc9, 0x2e, 0xee,
0x99, 0x94, 0xe6, 0x2e, 0xe0, 0x30, 0x65, 0x90, 0x92, 0xde, 0xea, 0xbe, 0x5d, 0x4b, 0x8e, 0x05,
0x58, 0x46, 0x72, 0xc6, 0x04, 0xef, 0xa0, 0x97, 0x72, 0x30, 0x5c, 0x2f, 0xb2, 0x8d, 0xc3, 0xdd,
0x24, 0xc1, 0x4b, 0x4e, 0xba, 0x05, 0x56, 0x43, 0xc6, 0xc3, 0xc7, 0xef, 0xa2, 0x9a, 0x10, 0x32,
0xe7, 0x2d, 0xf7, 0x8a, 0xe0, 0xdc, 0x49, 0xc3, 0x45, 0x51, 0x00, 0x06, 0x5f, 0x40, 0x08, 0xc1,
0x72, 0xf0, 0xa3, 0x9d, 0xc0, 0x33, 0x85, 0x2c, 0x40, 0x88, 0xec, 0xdb, 0x60, 0xc5, 0x46, 0x54,
0x61, 0x06, 0x77, 0x3d, 0x3e, 0xbe, 0x04, 0xf1, 0xa3, 0xa0, 0x85, 0x35, 0x32, 0x2b, 0x82, 0x85,
0xe3, 0xda, 0x65, 0xc7, 0x49, 0x57, 0xd6, 0x06, 0x98, 0x3a, 0x66, 0xbb, 0x81, 0xf1, 0x9c, 0xa3,
0x59, 0x37, 0xf3, 0x29, 0xc6, 0x82, 0xc8, 0xd9, 0x5d, 0xc9, 0x54, 0x5a, 0x63, 0x07, 0xcb, 0x37,
0x80, 0xb8, 0xe9, 0xf1, 0x8d, 0xa6, 0x3d, 0x39, 0xc4, 0x28, 0x05, 0x80, 0x9c, 0xd8, 0x40, 0xcb,
0x62, 0x5d, 0x07, 0x08, 0x0a, 0x35, 0x8c, 0xb5, 0x32, 0xf2, 0x7b, 0xa9, 0x31, 0x3b, 0xaa, 0x27,
0x4b, 0x7d, 0x5d, 0xd7, 0x13, 0xcd, 0x73, 0x60, 0xc4, 0x08, 0x5a, 0x32, 0x8c, 0xb2, 0x68, 0xf2,
0x61, 0xac, 0x39, 0x3d, 0xa2, 0x26, 0x8f, 0x7a, 0x0c, 0xd6, 0xd5, 0xce, 0x87, 0x63, 0x92, 0x09,
0xb6, 0x2f, 0x83, 0xaf, 0x84, 0xf2, 0x3f, 0xaf, 0x4d, 0x3f, 0xac, 0x25, 0xd4, 0x77, 0xac, 0xd4,
0x88, 0xd0, 0xa4, 0x66, 0x7d, 0x0a, 0x26, 0x2d, 0x6b, 0xac, 0x88, 0xf2, 0x19, 0xb2, 0x74, 0x41,
0xc6, 0x24, 0x1c, 0x75, 0x38, 0xd3, 0x23, 0xd2, 0xbc, 0x69, 0x7d, 0x0b, 0xa6, 0x2a, 0x4d, 0xa9,
0x75, 0xf2, 0xe9, 0xb4, 0xaa, 0x43, 0xf7, 0x23, 0x65, 0x72, 0xb7, 0xd1, 0xaf, 0xd3, 0xd9, 0x6c,
0x94, 0x0c, 0x3a, 0x28, 0x21, 0xa6, 0x49, 0xf2, 0xb0, 0xb7, 0xeb, 0x45, 0x3b, 0x23, 0xb3, 0x6f,
0x23, 0xd0, 0x29, 0xd5, 0xf6, 0x6f, 0xc0, 0x0d, 0xda, 0x25, 0xef, 0xa2, 0x05, 0xf2, 0x6c, 0xba,
0x3e, 0x48, 0x93, 0x22, 0x04, 0x6d, 0x82, 0xce, 0x90, 0xd6, 0x16, 0x73, 0x07, 0x0f, 0x8f, 0x23,
0xb3, 0x9f, 0xa8, 0xf1, 0x1f, 0xbd, 0x9c, 0x4a, 0xfe, 0x21, 0x56, 0x6a, 0xcd, 0xcc, 0xe2, 0xd7,
0x31, 0x76, 0x5b, 0x10, 0x59, 0x21, 0x6e, 0x9c, 0x33, 0xf1, 0xc7, 0xbf, 0x0a, 0x4d, 0x7e, 0x21,
0xad, 0x67, 0x09, 0xcb, 0x22, 0xd9, 0x52, 0x79, 0xcb, 0x11, 0x32, 0x1f, 0x26, 0x99, 0xa6, 0xf0,
0x65, 0xc2, 0x86, 0x4f, 0x0e, 0x21, 0x0b, 0x65, 0x36, 0xc9, 0x4c, 0xda, 0x69, 0x7c, 0x4b, 0x13,
0x22, 0x1d, 0xd6, 0x95, 0x01, 0xf0, 0xf6, 0xc4, 0x0f, 0x52, 0xb8, 0x20, 0x6e, 0x62, 0x57, 0xc7,
0x65, 0xdb, 0x82, 0x7f, 0xe3, 0x14, 0x22, 0x1b, 0x80, 0x92, 0x44, 0xef, 0x7a, 0xc7, 0x9f, 0x54,
0x75, 0x20, 0xd6, 0x5f, 0x67, 0xc5, 0x67, 0xdc, 0x97, 0x82, 0x8f, 0x16, 0x3b, 0x19, 0x27, 0x8f,
0x70, 0xee, 0xf0, 0xc9, 0x3c, 0x57, 0x45, 0x20, 0x48, 0x5d, 0x6b, 0xc3, 0x58, 0xdd, 0xa8, 0x85,
0x4c, 0x18, 0x66, 0x17, 0xc9, 0x8b, 0x84, 0xed, 0x5b, 0xcc, 0xe8, 0x59, 0x2b, 0x20, 0xbe, 0x5a,
0x63, 0xc1, 0x35, 0xde, 0xb4, 0x88, 0x1e, 0x1a, 0xa5, 0x15, 0x65, 0x88, 0x80, 0xec, 0xb3, 0xce,
0x9a, 0x5c, 0x23, 0x20, 0x3d, 0x58, 0x4b, 0xbf, 0xfb, 0xde, 0xc0, 0x8b, 0x03, 0x1c, 0xfc, 0x13,
0x02, 0x85, 0x63, 0xeb, 0xfd, 0xd0, 0x56, 0x5f, 0x31, 0x20, 0xc4, 0x55, 0x28, 0xbd, 0xb1, 0xdf,
0xc2, 0x8e, 0xf8, 0x1d, 0x67, 0x12, 0x99, 0x81, 0x30, 0xea, 0x39, 0xd3, 0x1d, 0x62, 0x57, 0x20,
0x55, 0x53, 0xf9, 0xba, 0x4b, 0xe0, 0xbd, 0x91, 0x03, 0x20, 0xea, 0x10, 0x36, 0x7e, 0xe6, 0xe8,
0x67, 0xd5, 0xed, 0x64, 0x8b, 0x20, 0xeb, 0x50, 0xbe, 0xb8, 0xd6, 0xe0, 0xb8, 0x94, 0x1c, 0x22,
0x83, 0x0f, 0xce, 0x7a, 0x86, 0xe7, 0x7f, 0xd7, 0xc3, 0x67, 0xdc, 0x20, 0x8f, 0x4e, 0x77, 0xb6,
0x4c, 0xe1, 0xa5, 0x97, 0x45, 0x24, 0x32, 0x0e, 0x64, 0x77, 0x0e, 0xe6, 0x8a, 0xd9, 0xa2, 0x6a,
0x3c, 0x21, 0x3d, 0x4c, 0x27, 0xb4, 0xad, 0xe1, 0x8e, 0x9a, 0x84, 0x26, 0xfa, 0x0c, 0xfd, 0x73,
0x80, 0xe4, 0x83, 0xdb, 0x85, 0x6d, 0xb0, 0x21, 0xf6, 0x49, 0xca, 0xb1, 0xf9, 0xe1, 0x6e, 0x9d,
0xcf, 0x28, 0xd6, 0x0b, 0x98, 0x70, 0xdf, 0xe2, 0x6b, 0xdd, 0x76, 0x70, 0x3e, 0x22, 0xb7, 0x47,
0x66, 0xaf, 0x32, 0xe2, 0x45, 0xa0, 0x2a, 0x2b, 0xc9, 0x0a, 0x33, 0x6d, 0x24, 0xe1, 0x3e, 0xdf,
0x68, 0x73, 0xdb, 0x22, 0x87, 0x45, 0xf7, 0xac, 0x52, 0xe2, 0x13, 0xa3, 0x96, 0x2d, 0xda, 0x09,
0xd9, 0x69, 0x58, 0xdf, 0x01, 0xe1, 0x60, 0x76, 0x8f, 0x23, 0x5f, 0x43, 0x81, 0xaa, 0x62, 0xe2,
0xd8, 0xa5, 0x0b, 0x30, 0xfa, 0x08, 0x79, 0x66, 0x73, 0xdd, 0xaf, 0xe2, 0x5a, 0x79, 0x58, 0x24,
0x48, 0x41, 0x03, 0xa8, 0x5c, 0xe2, 0x8f, 0xa8, 0x92, 0x32, 0x35, 0x08, 0x23, 0x63, 0x7d, 0xdb,
0x4a, 0xe4, 0x5b, 0x7c, 0x36, 0x25, 0x3d, 0x3f, 0x78, 0xa5, 0x3f, 0xe2, 0x3e, 0xab, 0x29, 0x35,
0x8c, 0x07, 0xd2, 0x5f, 0x72, 0xd9, 0xd0, 0xe5, 0x59, 0x7f, 0x22, 0x26, 0x3c, 0x3d, 0xec, 0xa2,
0x11, 0xe2, 0xe1, 0xad, 0xc8, 0x37, 0xfa, 0x06, 0x8a, 0x5c, 0x4e, 0xd7, 0x40, 0xe7, 0x63, 0x82,
0x2e, 0x27, 0x4d, 0x3b, 0x56, 0xa0, 0xcd, 0xe1, 0x7a, 0xb0, 0x75, 0x3a, 0x7a, 0x06, 0x41, 0x59,
0x20, 0xd5, 0xa0, 0xe8, 0x69, 0x85, 0x45, 0x28, 0x6c, 0x39, 0xb9, 0x9d, 0x74, 0xe1, 0x03, 0xb3,
0x2f, 0x3d, 0x17, 0x06, 0x02, 0x56, 0xda, 0xd2, 0xeb, 0xe9, 0x76, 0x88, 0x72, 0x29, 0x96, 0x37,
0x1d, 0x9b, 0x0c, 0xe1, 0x7e, 0xb5, 0xeb, 0x3f, 0xcc, 0x05, 0xd3, 0x52, 0x7f, 0xd0, 0x16, 0xeb,
0x7d, 0x8b, 0xb3, 0x2a, 0xd0, 0x35, 0x71, 0x98, 0x87, 0xe0, 0xf2, 0xb7, 0xbb, 0x42, 0x93, 0x05,
0xa1, 0x4f, 0x1c, 0xce, 0x37, 0xec, 0x86, 0x8e, 0x03, 0x2c, 0x20, 0x34, 0xc8, 0x95, 0xf1, 0xdf,
0x4f, 0xba, 0x98, 0x45, 0x80, 0x05, 0x7c, 0x4c, 0x96, 0xcb, 0x3e, 0xed, 0x95, 0x91, 0x6b, 0x2d,
0x74, 0x32, 0x19, 0x93, 0x4e, 0xdf, 0xa2, 0xbc, 0x6e, 0x48, 0x7e, 0x05, 0x6d, 0x49, 0x0c, 0xc9,
0x28, 0xee, 0x9a, 0x94, 0xed, 0x2e, 0xdf, 0x30, 0x61, 0x90, 0x97, 0xde, 0xf2, 0xbe, 0x5a, 0x4b,
0x84, 0x05, 0x57, 0x46, 0x7a, 0xc6, 0x06, 0xef, 0x96, 0x97, 0x6e, 0x30, 0x62, 0x2f, 0xb2, 0x8d,
0xb7, 0xdd, 0x22, 0xc1, 0x5a, 0x4e, 0xc0, 0x05, 0x49, 0x43, 0xbd, 0xc3, 0xd0, 0xef, 0xab, 0x9a,
0x0c, 0x32, 0xe2, 0x2d, 0xfd, 0x8a, 0xe6, 0xdc, 0x40, 0xc3, 0x39, 0x51, 0x0a, 0x06, 0x74, 0x40,
0x04, 0xc1, 0x5f, 0xf0, 0xa7, 0x9d, 0xd0, 0x33, 0x7f, 0x2c, 0x31, 0x88, 0xf2, 0xdb, 0x6e, 0xc5,
0x41, 0x54, 0x4e, 0x06, 0x74, 0x3d, 0x51, 0xbe, 0x0e, 0xf1, 0x93, 0xa0, 0x7b, 0x35, 0x44, 0x2b,
0x8a, 0x85, 0xd0, 0xda, 0x62, 0xc7, 0x62, 0x57, 0xdb, 0x06, 0x7f, 0x3a, 0x59, 0xbb, 0x90, 0xf1,
0xa9, 0xa3, 0x50, 0x37, 0xe6, 0x29, 0xd1, 0x82, 0xd8, 0xd9, 0x4b, 0xc9, 0x3b, 0x5a, 0x78, 0x07,
0xef, 0x37, 0x74, 0xb8, 0xc8, 0xf1, 0x94, 0xa6, 0x54, 0x39, 0xbd, 0x28, 0xf4, 0x7f, 0xa8, 0xd8,
0x57, 0xcb, 0x5b, 0x5d, 0xe7, 0x07, 0x07, 0x35, 0xb5, 0xb5, 0x43, 0xf2, 0x59, 0xa9, 0x24, 0x3b,
0xca, 0x27, 0x4e, 0x7d, 0x38, 0xd7, 0x14, 0xcd, 0x9c, 0x60, 0xc9, 0x08, 0x2d, 0x32, 0x6f, 0xb2,
0x81, 0xf2, 0x83, 0xac, 0x29, 0x3d, 0x85, 0x26, 0xa9, 0x7a, 0x2d, 0xd6, 0xb0, 0xce, 0x61, 0x63,
0xc0, 0x09, 0xef, 0x2f, 0x6a, 0xaf, 0x55, 0xf2, 0x4b, 0xaf, 0x71, 0x3f, 0xa6, 0x25, 0xb3, 0x77,
0xb6, 0xd4, 0xb6, 0xd0, 0x98, 0x66, 0x35, 0x0a, 0x24, 0x2d, 0xba, 0xac, 0x98, 0xf2, 0xdb, 0xb1,
0x6b, 0x41, 0xf8, 0x24, 0x1d, 0x75, 0x0a, 0xd3, 0x24, 0xd2, 0xf8, 0x69, 0x95, 0x0b, 0x5f, 0x2a,
0x09, 0xa9, 0xa6, 0xf2, 0x2e, 0xb5, 0x7b, 0x43, 0xc0, 0x23, 0x9e, 0x72, 0xe0, 0xd1, 0x66, 0xd3,
0xaa, 0x6c, 0xdc, 0x0c, 0x85, 0x28, 0x08, 0xa6, 0xff, 0xf1, 0xab, 0xb7, 0x30, 0x46, 0x43, 0x23,
0x68, 0x6f, 0x30, 0xd0, 0x8d, 0xd5, 0xd8, 0x6f, 0x41, 0x0d, 0xf5, 0x25, 0x71, 0xa3, 0x08, 0xf2,
0x17, 0xba, 0x38, 0x48, 0xcb, 0x22, 0x0d, 0x6d, 0x45, 0xce, 0x74, 0xd6, 0x75, 0x73, 0x45, 0x0f,
0xff, 0x22, 0x32, 0x9f, 0x1a, 0xf2, 0x8c, 0xbd, 0x35, 0x4a, 0xc0, 0x21, 0xc0, 0x6a, 0xee, 0xcc,
0x78, 0xd7, 0x03, 0x76, 0xb9, 0x10, 0xd2, 0x21, 0x62, 0x9c, 0x9f, 0xf0, 0xae, 0xbf, 0xa5, 0x4d,
0x81, 0x21, 0x0d, 0x67, 0x42, 0xcb, 0xce, 0xd9, 0xe6, 0x78, 0x07, 0x11, 0x87, 0x1f, 0xde, 0x99,
0xa9, 0xf0, 0xff, 0xc1, 0x58, 0x4f, 0x54, 0x21, 0x4d, 0x65, 0xc6, 0xc8, 0xfa, 0xd9, 0x3d, 0x7d,
0xc2, 0x13, 0xf6, 0x1b, 0x1a, 0x95, 0xf0, 0xf0, 0x79, 0xc5, 0x5a, 0x51, 0x81, 0x20, 0xfa, 0x62,
0x74, 0xc7, 0xeb, 0xda, 0x1e, 0x7f, 0x4d, 0x15, 0x25, 0x1c, 0x66, 0x92, 0xf6, 0xed, 0x7a, 0xc7,
0xdb, 0x55, 0x29, 0x20, 0xc1, 0x5e, 0x1c, 0xc6, 0x64, 0xdd, 0xb6, 0x81, 0x87, 0x15, 0xc4, 0x19,
0x3f, 0x90, 0xc2, 0xee, 0x32, 0xc9, 0x8d, 0x56, 0x0b, 0x21, 0xf8, 0x5d, 0x2b, 0xc2, 0xcf, 0xdc,
0x9a, 0x87, 0xcb, 0x18, 0xf4, 0x14, 0xd3, 0x8a, 0x2e, 0xef, 0x05, 0xcd, 0xf1, 0x58, 0xc3, 0x1f,
0x5a, 0x5b, 0xf5, 0xc1, 0x7d, 0xdd, 0x5b, 0x87, 0x37, 0x1b, 0x50, 0x18, 0x85, 0x87, 0x76, 0xe9,
0x86, 0xcf, 0x13, 0x5f, 0xdd, 0x1e, 0x76, 0x56, 0x0c, 0xc1, 0x8a, 0xe0, 0x0e, 0x8a, 0xd0, 0x19,
0x8d, 0x14, 0x4d, 0x88, 0x03, 0xed, 0xcd, 0xcd, 0x4e, 0x5d, 0xdf, 0x23, 0xf8, 0x56, 0x29, 0xb8,
0xa1, 0xdf, 0xc0, 0x95, 0xbf, 0x1d, 0xdb, 0x09, 0x6e, 0x7f, 0x3f, 0xef, 0x42, 0xd6, 0xe0, 0x5f,
0x5a, 0x1b, 0xd4, 0x57, 0xfd, 0xc2, 0x76, 0xd0, 0xe0, 0x86, 0x2d, 0x50, 0x40, 0x46, 0x00, 0x46,
0xc0, 0x45, 0x80, 0x45, 0x40, 0x45, 0x00, 0x45, 0xc0, 0x44, 0x80, 0x44, 0x40, 0x44, 0x00, 0x44,
0xc0, 0x43, 0x80, 0x43, 0x40, 0x43, 0x00, 0x43, 0xc0, 0x42, 0x80, 0x42, 0x40, 0x42, 0x00, 0x42,
0xc0, 0x41, 0x80, 0x41, 0x40, 0x41, 0x00, 0x41, 0xc0, 0x40, 0x80, 0x40, 0x40, 0x40, 0x00, 0x40,
0xc0, 0x3f, 0x80, 0x3f, 0x40, 0x3f, 0x00, 0x3f, 0xc0, 0x3e, 0x80, 0x3e, 0x40, 0x3e, 0x00, 0x3e,
0xc0, 0x3d, 0x80, 0x3d, 0x40, 0x3d, 0x00, 0x3d, 0xc0, 0x3c, 0x80, 0x3c, 0x40, 0x3c, 0x00, 0x3c,
0xc0, 0x3b, 0x80, 0x3b, 0x40, 0x3b, 0x00, 0x3b, 0xc0, 0x3a, 0x80, 0x3a, 0x40, 0x3a, 0x00, 0x3a,
0xc0, 0x39, 0x80, 0x39, 0x40, 0x39, 0x00, 0x39, 0xc0, 0x38, 0x80, 0x38, 0x40, 0x38, 0x00, 0x38,
0xc0, 0x37, 0x80, 0x37, 0x40, 0x37, 0x00, 0x37, 0xc0, 0x36, 0x80, 0x36, 0x40, 0x36, 0x00, 0x36,
0xc0, 0x35, 0x80, 0x35, 0x40, 0x35, 0x00, 0x35, 0xc0, 0x34, 0x80, 0x34, 0x40, 0x34, 0x00, 0x34,
0xc0, 0x33, 0x80, 0x33, 0x40, 0x33, 0x00, 0x33, 0xc0, 0x32, 0x80, 0x32, 0x40, 0x32, 0x00, 0x32,
0xc0, 0x31, 0x80, 0x31, 0x40, 0x31, 0x00, 0x31, 0xc0, 0x30, 0x80, 0x30, 0x40, 0x30, 0x00, 0x30,
0xc0, 0x2f, 0x80, 0x2f, 0x40, 0x2f, 0x00, 0x2f, 0xc0, 0x2e, 0x80, 0x2e, 0x40, 0x2e, 0x00, 0x2e,
0xc0, 0x2d, 0x80, 0x2d, 0x40, 0x2d, 0x00, 0x2d, 0xc0, 0x2c, 0x80, 0x2c, 0x40, 0x2c, 0x00, 0x2c,
0xc0, 0x2b, 0x80, 0x2b, 0x40, 0x2b, 0x00, 0x2b, 0xc0, 0x2a, 0x80, 0x2a, 0x40, 0x2a, 0x00, 0x2a,
0xc0, 0x29, 0x80, 0x29, 0x40, 0x29, 0x00, 0x29, 0xc0, 0x28, 0x80, 0x28, 0x40, 0x28, 0x00, 0x28,
0xc0, 0x27, 0x80, 0x27, 0x40, 0x27, 0x00, 0x27, 0xc0, 0x26, 0x80, 0x26, 0x40, 0x26, 0x00, 0x26,
0xc0, 0x25, 0x80, 0x25, 0x40, 0x25, 0x00, 0x25, 0xc0, 0x24, 0x80, 0x24, 0x40, 0x24, 0x00, 0x24,
0xc0, 0x23, 0x80, 0x23, 0x40, 0x23, 0x00, 0x23, 0xc0, 0x22, 0x80, 0x22, 0x40, 0x22, 0x00, 0x22,
0xc0, 0x21, 0x80, 0x21, 0x40, 0x21, 0x00, 0x21, 0xc0, 0x20, 0x80, 0x20, 0x40, 0x20, 0x00, 0x20,
0xc0, 0x1f, 0x80, 0x1f, 0x40, 0x1f, 0x00, 0x1f, 0xc0, 0x1e, 0x80, 0x1e, 0x40, 0x1e, 0x00, 0x1e,
0xc0, 0x1d, 0x80, 0x1d, 0x40, 0x1d, 0x00, 0x1d, 0xc0, 0x1c, 0x80, 0x1c, 0x40, 0x1c, 0x00, 0x1c,
0xc0, 0x1b, 0x80, 0x1b, 0x40, 0x1b, 0x00, 0x1b, 0xc0, 0x1a, 0x80, 0x1a, 0x40, 0x1a, 0x00, 0x1a,
0xc0, 0x19, 0x80, 0x19, 0x40, 0x19, 0x00, 0x19, 0xc0, 0x18, 0x80, 0x18, 0x40, 0x18, 0x00, 0x18,
0xc0, 0x17, 0x80, 0x17, 0x40, 0x17, 0x00, 0x17, 0xc0, 0x16, 0x80, 0x16, 0x40, 0x16, 0x00, 0x16,
0xc0, 0x15, 0x80, 0x15, 0x40, 0x15, 0x00, 0x15, 0xc0, 0x14, 0x80, 0x14, 0x40, 0x14, 0x00, 0x14,
0xc0, 0x13, 0x80, 0x13, 0x40, 0x13, 0x00, 0x13, 0xc0, 0x12, 0x80, 0x12, 0x40, 0x12, 0x00, 0x12,
0xc0, 0x11, 0x80, 0x11, 0x40, 0x11, 0x00, 0x11, 0xc0, 0x10, 0x80, 0x10, 0x40, 0x10, 0x00, 0x10,
0xc0, 0x0f, 0x80, 0x0f, 0x40, 0x0f, 0x00, 0x0f, 0xc0, 0x0e, 0x80, 0x0e, 0x40, 0x0e, 0x00, 0x0e,
0xc0, 0x0d, 0x80, 0x0d, 0x40, 0x0d, 0x00, 0x0d, 0xc0, 0x0c, 0x80, 0x0c, 0x40, 0x0c, 0x00, 0x0c,
0xc0, 0x0b, 0x80, 0x0b, 0x40, 0x0b, 0x00, 0x0b, 0xc0, 0x0a, 0x80, 0x0a, 0x40, 0x0a, 0x00, 0x0a,
0xc0, 0x09, 0x80, 0x09, 0x40, 0x09, 0x00, 0x09, 0xc0, 0x08, 0x80, 0x08, 0x40, 0x08, 0x00, 0x08,
0xc0, 0x07, 0x80, 0x07, 0x40, 0x07, 0x00, 0x07, 0xc0, 0x06, 0x80, 0x06, 0x40, 0x06, 0x00, 0x06,
0xc0, 0x05, 0x80, 0x05, 0x40, 0x05, 0x00, 0x05, 0xc0, 0x04, 0x80, 0x04, 0x40, 0x04, 0x00, 0x04,
0xc0, 0x03, 0x80, 0x03, 0x40, 0x03, 0x00, 0x03, 0xc0, 0x02, 0x80, 0x02, 0x40, 0x02, 0x00, 0x02,
0xc0, 0x01, 0x80, 0x01, 0x40, 0x01, 0x00, 0x01, 0xc0, 0x00, 0x80, 0x00, 0x40, 0x00
};

void DMA_Systick_ISR(void)
{
	if(sound_en)
	{
		if(sound_s<sound_len)
		{
			Send_DAC_data(sound_buf[sound_s]);
			sound_s++;
		}
		else
		{
			SysTick->CTRL &= ~SysTick_CTRL_ENABLE_Msk; 
			sound_en=0;	
		}
	}
}
void Play_Audio(unsigned char *buf,unsigned int l,unsigned int rate,unsigned char mul)
{
	unsigned int g_fp_delayclk = g_sys_clk/(1000*1000);
	unsigned int us;
	us=1000000/rate;
	sound_s=0;
	sound_buf=buf;
	sound_len=l;
	sound_en=1;

	DAC_Init(RIGHTALIGNED_8BITS,TRIGGER_SOFTWARE,DET_ON_LOW);
	SysTick_Config(g_fp_delayclk*us);
	if(mul)         //??????  
	{
		while(sound_s<sound_len){}  
		SysTick->CTRL &= ~SysTick_CTRL_ENABLE_Msk;  
		sound_en=0;			
	}		
}

UINT32 play_song_compete;

void Audio_ISR(void)
{
	play_song_compete=0;
//	DMA_dis(0);
//	PIT_dis();
}

extern DMA_LLI g_dma_lli[100];
volatile unsigned int g_song_spiaddr;		//??????????SPI-Flash??
UINT32 link_index;
UINT32 link_index_max;
UINT8 Single_TranDma;

/*******************************************************************************
* Function Name  : Play_Audio_SSI_SRTDA
* Description    : ?sram????,??DMA??????,????????SSI???spi flash????????
* Input          : - *buf:??????
*                : - l   :??????
*                : - freq:???????
*                : - mul :?????0:???;1:??
                 :- speed : ????
                 :- num:??????:???????????,?????????????,?????
                 :- less_num:???????????
                 :- stop_dec:???????????????
* Output         : None
* Return         : None
******************************************************************************/
void Play_Audio_SSI_SRTDA(unsigned char *buf,unsigned int l,unsigned int freq,unsigned char mul,unsigned char speed,unsigned char num,unsigned int less_num,unsigned char stop_dec,int value)
{
	UINT32 song_addr,song_len,song_point,tran_l;
	UINT32 i,lli_num;
	UINT8 DMA_ch=0;
	link_index = 0;
	link_index_max = 0;

	song_addr=(UINT32)(buf);
	CPM->CPM_SYSRSTCR |= 0x01<<2;
	CPM->CPM_SYSRSTCR &= ~(0x01<<2);//???????,????????

	song_len=l;
	play_song_compete=1;
	tran_l=l;
	song_point=0;
	
	DMA_dis(0);

	PIT32_Stop(PIT2);
	
	DAC_Init(LEFTALIGNED_12BITS, TRIGGER_PIT, DET_ON_RISING);
	DMA_REG_Init(DMA2_BASE_ADDR);
	NVIC_Init(3, 3, DMA2_IRQn, 2);	
	
	if(song_len>(DMA2_MAX_TRANSLEN<<1))
	{
		tran_l=DMA2_MAX_TRANSLEN;
		song_point=0;
		lli_num=song_len/(DMA2_MAX_TRANSLEN<<1);
		if(song_len%(DMA2_MAX_TRANSLEN<<1))
		{
			lli_num++;
		}
			link_index_max = lli_num;
		for(i=0;i<lli_num;i++)
		{
			g_dma_lli[i].src_addr=song_addr+song_point;
			g_dma_lli[i].dst_addr=0x40021004;
			if(i<(lli_num-1))
			{
				g_dma_lli[i].next_lli=(UINT32)&g_dma_lli[i+1];
			}
			else
			{
				g_dma_lli[i].next_lli=0;
			}
			  g_dma_lli[i].control0=INTEN|DNOCHG|M2P_DMA|DWIDTH_HW|SWIDTH_HW|LLP_SRC_EN|SIEC;
		
			g_dma_lli[i].len=tran_l;
			g_dma_lli[i].hs_sel = 0;
			g_dma_lli[i].per=0;
			song_point+=(tran_l<<1);
			song_len-=(tran_l<<1);
			if(song_len>(DMA2_MAX_TRANSLEN<<1))
			{
				tran_l=DMA2_MAX_TRANSLEN;
			}
			else
			{
				tran_l=(song_len>>1);
			}
		}	
		dma_lli_reg_init(DMA_ch,&g_dma_lli[0]);
	}
	
	else
	{	
		tran_l=(song_len/2);
		song_point=0;
		
			Single_TranDma=1;
		DMA_DAC_Tran(DMA_ch,song_addr,tran_l);
	
	}
	
	DAC_Start(TRIGGER_PIT,freq*speed);
	if(mul)
	{
		if(stop_dec==1)
		{
		if(AUDIO_FRAME_SIZE*(num+1)<=AUDIO_LEN)
		{
			SSI_EFlash_QUAD_Read(SSI1, AUDIO_ADDR +AUDIO_FRAME_SIZE*(num), EncodeBuffer, AUDIO_FRAME_SIZE);
			if(num%2!=0)
				adpcm_decoder(EncodeBuffer, tmp_buf, AUDIO_FRAME_SIZE, &dec_state,value);
			else	
		adpcm_decoder(EncodeBuffer, tmp_buf, AUDIO_FRAME_SIZE, &dec_state,value);	 
		}
		else
		{
			SSI_EFlash_QUAD_Read(SSI1, AUDIO_ADDR +AUDIO_FRAME_SIZE*(num), EncodeBuffer, less_num);
			if(num%2!=0)
				adpcm_decoder(EncodeBuffer, tmp_buf, less_num, &dec_state,value);
			else	
		adpcm_decoder(EncodeBuffer, Buffer2, less_num, &dec_state,value);	 
		}
	}
    
			
		while(play_song_compete)
		{
			Interrupt_Task();
		}
		
	}
}


/*******************************************************************************
* Function Name  : Play_Audio_SPI_SRTDA
* Description    : ?sram????,??DMA??????,????????SPI???spi flash????????
* Input          : - SPIx: SPI??
                 : - *buf:??????
*                : - l   :??????
*                : - freq:???????
*                : - mul :?????0:???;1:??
                 :- speed : ????
                 :- num:??????:???????????,?????????????,?????
                 :- less_num:???????????
                 :- stop_dec:???????????????
* Output         : None
* Return         : None
******************************************************************************/
void Play_Audio_SPI_SRTDA(SPI_TypeDef* SPIx,unsigned char *buf,unsigned int l,unsigned int freq,unsigned char mul,unsigned char speed,unsigned char num,unsigned int less_num,unsigned char stop_dec,int value)
{
	UINT32 song_addr,song_len,song_point,tran_l;
	UINT32 i,lli_num;
	UINT8 DMA_ch=0;
	link_index = 0;
	link_index_max = 0;

	song_addr=(UINT32)(buf);
	CPM->CPM_SYSRSTCR |= 0x01<<2;
	CPM->CPM_SYSRSTCR &= ~(0x01<<2);//???????,????????

	song_len=l;
	play_song_compete=1;
	tran_l=l;
	song_point=0;
	
	DMA_dis(0);

	PIT32_Stop(PIT2);
	
	DAC_Init(LEFTALIGNED_12BITS, TRIGGER_PIT, DET_ON_RISING);
	DMA_REG_Init(DMA2_BASE_ADDR);
	NVIC_Init(3, 3, DMA2_IRQn, 2);	
	
	if(song_len>(DMA2_MAX_TRANSLEN<<1))
	{
		tran_l=DMA2_MAX_TRANSLEN;
		song_point=0;
		lli_num=song_len/(DMA2_MAX_TRANSLEN<<1);
		if(song_len%(DMA2_MAX_TRANSLEN<<1))
		{
			lli_num++;
		}
			link_index_max = lli_num;
		for(i=0;i<lli_num;i++)
		{
			g_dma_lli[i].src_addr=song_addr+song_point;
			g_dma_lli[i].dst_addr=0x40021004;
			if(i<(lli_num-1))
			{
				g_dma_lli[i].next_lli=(UINT32)&g_dma_lli[i+1];
			}
			else
			{
				g_dma_lli[i].next_lli=0;
			}
			  g_dma_lli[i].control0=INTEN|DNOCHG|M2P_DMA|DWIDTH_HW|SWIDTH_HW|LLP_SRC_EN|SIEC;
		
			g_dma_lli[i].len=tran_l;
			g_dma_lli[i].hs_sel = 0;
			g_dma_lli[i].per=0;
			song_point+=(tran_l<<1);
			song_len-=(tran_l<<1);
			if(song_len>(DMA2_MAX_TRANSLEN<<1))
			{
				tran_l=DMA2_MAX_TRANSLEN;
			}
			else
			{
				tran_l=(song_len>>1);
			}
		}	
		dma_lli_reg_init(DMA_ch,&g_dma_lli[0]);
	}
	
	else
	{	
		tran_l=(song_len/2);
		song_point=0;
		
			Single_TranDma=1;
		DMA_DAC_Tran(DMA_ch,song_addr,tran_l);
	
	}
	
	DAC_Start(TRIGGER_PIT,freq*speed);
	if(mul)
	{
		if(stop_dec==1)
		{
		if(AUDIO_FRAME_SIZE*(num+1)<=AUDIO_LEN)
		{
			SSI_EFlash_QUAD_Read(SSI1, AUDIO_ADDR +AUDIO_FRAME_SIZE*(num), EncodeBuffer, AUDIO_FRAME_SIZE);
			if(num%2!=0)
				adpcm_decoder(EncodeBuffer, tmp_buf, AUDIO_FRAME_SIZE, &dec_state,value);
			else	
		adpcm_decoder(EncodeBuffer, Buffer2, AUDIO_FRAME_SIZE, &dec_state,value);	 
		}
		else
		{
			SSI_EFlash_QUAD_Read(SSI1, AUDIO_ADDR +AUDIO_FRAME_SIZE*(num), EncodeBuffer, less_num);
			if(num%2!=0)
				adpcm_decoder(EncodeBuffer, tmp_buf, less_num, &dec_state,value);
			else	
		adpcm_decoder(EncodeBuffer, Buffer2, less_num, &dec_state,value);	 
		}
	}
    
			
		while(play_song_compete)
		{
	
      Interrupt_Task();
			
		}
		
	}
}


/*******************************************************************************
* Function Name  : DAC_Audio_SSI_Demo
* Description    : ????SSI???spi flash????????sram?
* Input          : - addr:?????spi flash????
                 : -ini_addr:?????spi flash???
*                : - len:??????
                 :- freq:?????

*                : - mul :?????0:???;1:??
* Output         : None
* Return         : None
******************************************************************************/
UINT8 DAC_Audio_SSI_Demo(UINT32 addr,UINT32 ini_addr,UINT32 len,UINT32  freq,int value)
{


	UINT8 tran_num=0;
	UINT32 less_num=0,i;
	UINT32 data_len;
	UINT8 mul=1;
	key_value=0xff;
	UINT16 temp,end_addr,base_data,start_addr;;
  AUDIO_ADDR=addr+ini_addr;
	AUDIO_LEN=len;
	break_song_compete=1;
  exit_to_break=0;
    //----------------------------------------------------------------------	
//	while(1)
//	{
		 dec_state.valprev = 0x0;
    dec_state.index = 0;
      SSI_Standard_Init(SSI1); //spi flash ?????
	    SSI_EFlash_Write_Enable(SSI1);//???
	  if(AUDIO_LEN<AUDIO_FRAME_SIZE)//??????
		{	

			 SSI_EFlash_QUAD_Read(SSI1, AUDIO_ADDR , EncodeBuffer, AUDIO_LEN);//??spi flash????

			 adpcm_decoder(EncodeBuffer, Buffer2, AUDIO_LEN, &dec_state,value); //????
			/*????*/
			 temp=Buffer2[0];
		for(end_addr=0,base_data=0,data_len=0;temp>base_data;end_addr=end_addr+2)
	{
		base_data=base_data+0x10;
		data_len=data_len+0x02;
	}		

		 SSI_EFlash_QUAD_Read(SSI1, ini_addr, tmp_buf, AUDIO_FRAME_SIZE);//???????????spi flash???

     Play_Audio_SSI_SRTDA((UINT8 *)tmp_buf,data_len,freq,1,1,0,less_num,0,value); //????	

	   Play_Audio_SSI_SRTDA((UINT8 *)Buffer2,AUDIO_LEN*4,freq,1,1,0,less_num,0,value); //????	
	
	/*????*/
	temp=(DAC->DAC_DOR<<4);

	for(start_addr=0,base_data=0xfff0,data_len=0x2000;temp<base_data;start_addr=start_addr+2)
	{
		base_data=base_data-0x10;
		data_len=data_len-0x02;
	}

  	SSI_EFlash_QUAD_Read(SSI1, ini_addr+0x2000+start_addr, tmp_buf, data_len);	//??????

		Play_Audio_SSI_SRTDA((UINT8 *)(tmp_buf  ),data_len  ,freq,1,1,0,less_num,0,value);//????
	
		}
		else
			{
			tran_num=AUDIO_LEN/AUDIO_FRAME_SIZE;		//???
		  less_num=AUDIO_LEN%AUDIO_FRAME_SIZE;   //???????????

		/*???????1*/
		  SSI_EFlash_QUAD_Read(SSI1, AUDIO_ADDR , EncodeBuffer, AUDIO_FRAME_SIZE);//????????
      adpcm_decoder(EncodeBuffer, Buffer2, AUDIO_FRAME_SIZE, &dec_state,value); //??
	    temp=Buffer2[0];
		for(end_addr=0,base_data=0,data_len=0;temp>base_data;end_addr=end_addr+2)
	{
		base_data=base_data+0x10;
		data_len=data_len+0x02;
	}		
		 SSI_EFlash_QUAD_Read(SSI1, ini_addr, tmp_buf, AUDIO_FRAME_SIZE);//??????
     if(break_song_compete!=0)
		 {
     Play_Audio_SSI_SRTDA((UINT8 *)tmp_buf,data_len,freq,1,1,0,less_num,0,value); //??????	

		  Play_Audio_SSI_SRTDA((UINT8 *)Buffer2,sizeof(Buffer2),freq,mul,1,1,less_num,1,value); //????????	
		 }
//    /*???????,??????*/ 
		for(i=2;i<=tran_num;i++)
{	
	if(break_song_compete!=0)
	{
		if(exit_to_break==0)
		{
	if(i%2!=0)
  Play_Audio_SSI_SRTDA((UINT8 *)Buffer2,sizeof(Buffer2),freq,mul,1,i,less_num,1,value);		
	 else
	Play_Audio_SSI_SRTDA((UINT8 *)tmp_buf,sizeof(tmp_buf),freq,mul,1,i,less_num,1,value); 		 
 }
		}
	}
if(exit_to_break==0)
{
		if(less_num!=0)
		{
						if((i-1)%2!=0)
     
	   Play_Audio_SSI_SRTDA((UINT8 *)tmp_buf,less_num*4,freq,mul,1,0,less_num,0,value); //???????????
		   else
		Play_Audio_SSI_SRTDA((UINT8 *)Buffer2,less_num*4,freq,mul,1,0,less_num,0,value); //???????????
		}
	}
	//	/*????DAC???????????????*/

	temp=(DAC->DAC_DOR<<4);



	for(start_addr=0,base_data=0xfff0,data_len=0x2000;temp<base_data;start_addr=start_addr+2)
	{
		base_data=base_data-0x10;
		data_len=data_len-0x02;
	}

if((i-1)%2!=0)
{
	  SSI_EFlash_QUAD_Read(SSI1, ini_addr+0x2000+start_addr, Buffer2, data_len);	
		Play_Audio_SSI_SRTDA((UINT8 *)(Buffer2  ),data_len  ,freq,mul,1,0,less_num,0,value);
}		
	else
	{
		 SSI_EFlash_QUAD_Read(SSI1, ini_addr+0x2000+start_addr, tmp_buf, data_len);	
		Play_Audio_SSI_SRTDA((UINT8 *)(tmp_buf  ),data_len  ,freq,mul,1,0,less_num,0,value);
	}
    

		}
			if(exit_to_break==0&&break_song_compete==1)
				return song_complete;
			else
				return song_break;
	
}
/*******************************************************************************
* Function Name  : DAC_Audio_SPI_Demo
* Description    : ????SPI???SPI FLASH?????SRAM
* Input          : - SPIx: SPI??
                 : - addr:?????spi flash??
*                : - len   :??????

*                : - mul :?????0:???;1:??
* Output         : None
* Return         : None


******************************************************************************/
void DAC_Audio_SPI_Demo(SPI_TypeDef* SPIx,UINT32 addr,UINT32 len,UINT8 mul,int value )
{


	UINT8 tran_num=0;
	UINT32 less_num=0,i;
	UINT32 data_len;
	UINT16 temp,end_addr,base_data,start_addr;;
  AUDIO_ADDR=addr+0x10200000;
	AUDIO_LEN=len;

unsigned char temp1;
    //----------------------------------------------------------------------	

		 dec_state.valprev = 0x0;
			dec_state.index = 0;

				if(AUDIO_LEN<AUDIO_FRAME_SIZE)//??????
				{	
//						SPI_FLASH_BufferRead(SPIx ,EncodeBuffer, AUDIO_ADDR, AUDIO_LEN);

					 adpcm_decoder(EncodeBuffer, Buffer2, AUDIO_LEN, &dec_state,value); 
					/*????*/
					 temp=Buffer2[0];
					for(end_addr=0,base_data=0,data_len=0;temp>base_data;end_addr=end_addr+2)
					{
						base_data=base_data+0x10;
						data_len=data_len+0x02;
					}		
//					SPI_FLASH_BufferRead(SPIx,(unsigned char *)tmp_buf, 0x10200000, AUDIO_FRAME_SIZE);

					Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)tmp_buf,data_len,44100,1,1,0,less_num,0,value); //????	

					Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)Buffer2,AUDIO_LEN*4,22050,1,1,0,less_num,0,value); //????	
			
					/*????*/
					temp=(DAC->DAC_DOR<<4);

					for(start_addr=0,base_data=0xfff0,data_len=0x2000;temp<base_data;start_addr=start_addr+2)
					{
						base_data=base_data-0x10;
						data_len=data_len-0x02;
					}
//					SPI_FLASH_BufferRead(SPIx,(unsigned char *)tmp_buf, 0x10202000+start_addr, data_len);
					Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)(tmp_buf  ),data_len  ,44100,1,1,0,less_num,0,value);
			
				}
			else//??????
			{	
						tran_num=AUDIO_LEN/AUDIO_FRAME_SIZE;		//DMA Linkêy×éêyá?
						less_num=AUDIO_LEN%AUDIO_FRAME_SIZE;

					/*???????1*/
//				SPI_FLASH_BufferRead(SPIx,(unsigned char *)EncodeBuffer, AUDIO_ADDR, AUDIO_FRAME_SIZE);

						adpcm_decoder(EncodeBuffer, Buffer2, AUDIO_FRAME_SIZE, &dec_state,value); 
						temp=Buffer2[0];
					for(end_addr=0,base_data=0,data_len=0;temp>base_data;end_addr=end_addr+2)
				{
					base_data=base_data+0x10;
					data_len=data_len+0x02;
				}		
//				SPI_FLASH_BufferRead(SPIx,(unsigned char *)tmp_buf, 0x10200000, AUDIO_FRAME_SIZE);


					 Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)tmp_buf,data_len,44100,1,1,0,less_num,0,value); //????	

						Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)Buffer2,sizeof(Buffer2),22050,mul,1,1,less_num,1,value); //????	
				
			//    /*???????,??????*/ 
					for(i=2;i<=tran_num;i++)
			{		
				if(i%2!=0)
				Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)Buffer2,sizeof(Buffer2),22050,mul,1,i,less_num,1,value); //????		
				 else
				Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)tmp_buf,sizeof(tmp_buf),22050,mul,1,i,less_num,1,value); //????		 
			}
				
					if(less_num!=0)
					{
									if((i-1)%2!=0)
					 
					 Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)tmp_buf,less_num*4,22050,mul,1,0,less_num,0,value); //????
						 else
					Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)Buffer2,less_num*4,22050,mul,1,0,less_num,0,value); //????	
					}
				
				//	/*????DAC???????????????*/

				temp=(DAC->DAC_DOR<<4);



				for(start_addr=0,base_data=0xfff0,data_len=0x2000;temp<base_data;start_addr=start_addr+2)
				{
					base_data=base_data-0x10;
					data_len=data_len-0x02;
				}

				if((i-1)%2!=0)
				{
//					SPI_FLASH_BufferRead(SPIx,(unsigned char *)Buffer2, 0x10202000+start_addr, data_len);

						Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)(Buffer2  ),data_len  ,44100,1,1,0,less_num,0,value);
				}		
				else
				{
//					SPI_FLASH_BufferRead(SPIx,(unsigned char *)tmp_buf, 0x10202000+start_addr, data_len);
					Play_Audio_SPI_SRTDA(SPIx,(UINT8 *)(tmp_buf  ),data_len  ,44100,1,1,0,less_num,0,value);
				}
					
			}

}
/*******************************************************************************
* Function Name  : DAC_Audio_SSI_SRAM_PLAY
* Description    : ???SRAM ???? DMA ????????,??SSI??
* Input          : - addr:?????spi flash???
*                : - len   :??????

*                : - mul :?????0:???;1:??
* Output         : None
* Return         : None
******************************************************************************/
void DAC_Audio_SSI_SRAM_PLAY(UINT32 addr,UINT32 len,UINT32  freq,UINT8 mul,int value)
	{
   Play_Audio_SSI_SRTDA((UINT8 *)addr,len,freq,mul,1,0,0,0,value); 
}

/*******************************************************************************
* Function Name  : DAC_Audio_SPI_SRAM_PLAY
* Description    : ???SRAM ???? DMA ????????
* Input          : - addr:?????spi flash???
*                : - len   :??????

*                : - mul :?????0:???;1:??
* Output         : None
* Return         : None
******************************************************************************/
void DAC_Audio_SPI_SRAM_PLAY(UINT32 addr,UINT32 len,UINT32  freq,UINT8 mul,int value)
	{
   Play_Audio_SPI_SRTDA(SPI1,(UINT8 *)addr,len,freq,mul,1,0,0,0,value); 
  }
/*******************************************************************************
* Function Name  : audio_play
* Description    : ²¥·ÅÓïÒô
* Input          : - VoiceType£ºÓïÒô¶Î
*                : - value   :ÉùÒô´óÐ¡µ÷½Ú
	* Output         : 0:±íÊ¾ÓïÒô²¥·ÅÍê±Ï
                     1£º±íÊ¾ÓïÒôÆäËûÊÂ¼þ´ò¶Ï	
******************************************************************************/
UINT8	audio_play(AUDIO_VOICE_TYPE VoiceType,int value)
{
	UINT8 paly_status;
 if(VoiceType!=C_AUDIO_KICK)
 {
	 paly_status=DAC_Audio_SSI_Demo((UINT8 *)(AudioMem[VoiceType][AudioAddr]) ,0x10200000,AudioMem[VoiceType][AudioSize],AUDIO_FREQ ,value);
	 return paly_status;
 
 }
 else
	{
		DAC_Audio_SSI_SRAM_PLAY((UINT8 *)data_buf1,sizeof(data_buf1),22050,1,value);  //????	
    return 0;
	}		
}

